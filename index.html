<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ตารางติดตามหนี้</title>
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    .controls {
      text-align: center;
      margin-bottom: 20px;
    }

    input, button {
      margin: 5px;
      padding: 5px;
      font-size: 16px;
    }

    table {
      width: 100%;
      margin-bottom: 30px;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #3498db;
      color: white;
    }

    td button {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 3px 6px;
      cursor: pointer;
    }

    .summary {
      text-align: center;
      margin-top: 20px;
    }

    .hidden {
      display: none;
    }

    .toggle-summary {
      background-color: #27ae60;
      color: white;
    }

    .remove-debt {
      background-color: #e67e22;
      color: white;
    }
  </style>
</head>
<body>

<h1>ตารางติดตามหนี้</h1>

<div class="controls">
  <input type="text" id="debtNameInput" placeholder="ชื่อหนี้">
  <input type="month" id="startMonthInput">
  <input type="number" id="monthsInput" placeholder="จำนวนเดือน">
  <button onclick="addDebt()">เพิ่มหนี้</button>
  <button onclick="clearData()">ล้างข้อมูลทั้งหมด</button>
  <button onclick="toggleSummary()">แสดง/ซ่อนผลรวม</button>
</div>

<div id="debtContainer"></div>
<div class="summary hidden" id="summarySection"></div>

<script>
  let debts = JSON.parse(localStorage.getItem('debts') || '[]');

  function saveData() {
    localStorage.setItem('debts', JSON.stringify(debts));
  }

  function addDebt() {
    const name = document.getElementById('debtNameInput').value.trim();
    const startMonth = document.getElementById('startMonthInput').value;
    const months = parseInt(document.getElementById('monthsInput').value);

    if (!name || !startMonth || !months) return alert('กรุณากรอกข้อมูลให้ครบ');

    debts.push({
      name,
      startMonth,
      months,
      payments: Array(months).fill(0)
    });

    saveData();
    renderDebts();
  }

  function deleteDebt(index) {
    if (confirm("ลบหนี้นี้จริงหรือไม่?")) {
      debts.splice(index, 1);
      saveData();
      renderDebts();
    }
  }

  function removeMonth(debtIndex, monthIndex) {
    debts[debtIndex].payments.splice(monthIndex, 1);
    debts[debtIndex].months -= 1;
    saveData();
    renderDebts();
  }

  function updateAmount(debtIndex, monthIndex, value) {
    debts[debtIndex].payments[monthIndex] = parseFloat(value) || 0;
    saveData();
    renderDebts();
  }

  function toggleSummary() {
    const section = document.getElementById('summarySection');
    section.classList.toggle('hidden');
  }

  function renderDebts() {
    const container = document.getElementById('debtContainer');
    container.innerHTML = '';
    const summary = document.getElementById('summarySection');
    summary.innerHTML = '';

    let overallTotal = 0;
    let monthlyTotals = {};

    debts.forEach((debt, i) => {
      const table = document.createElement('table');
      const header = document.createElement('tr');
      const title = document.createElement('th');
      title.colSpan = 3;
      title.textContent = `${debt.name} (เริ่ม ${debt.startMonth}, ${debt.months} เดือน)`;
      header.appendChild(title);
      table.appendChild(header);

      const headRow = document.createElement('tr');
      headRow.innerHTML = '<th>เดือน</th><th>ยอด</th><th>ลบเดือน</th>';
      table.appendChild(headRow);

      let month = new Date(debt.startMonth);
      let total = 0;

      for (let j = 0; j < debt.months; j++) {
        const row = document.createElement('tr');

        const monthText = month.toLocaleString('th-TH', { month: 'short', year: 'numeric' });
        const monthCell = document.createElement('td');
        monthCell.textContent = monthText;
        row.appendChild(monthCell);

        const inputCell = document.createElement('td');
        const input = document.createElement('input');
        input.type = 'number';
        input.value = debt.payments[j];
        input.onchange = () => updateAmount(i, j, input.value);
        inputCell.appendChild(input);
        row.appendChild(inputCell);

        const deleteBtnCell = document.createElement('td');
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'ลบ';
        deleteBtn.onclick = () => removeMonth(i, j);
        deleteBtnCell.appendChild(deleteBtn);
        row.appendChild(deleteBtnCell);

        table.appendChild(row);

        const key = monthText;
        monthlyTotals[key] = (monthlyTotals[key] || 0) + debt.payments[j];
        total += debt.payments[j];

        month.setMonth(month.getMonth() + 1);
      }

      overallTotal += total;

      const totalRow = document.createElement('tr');
      totalRow.innerHTML = `<td colspan="3"><strong>รวม: ${total.toLocaleString()} บาท</strong></td>`;
      table.appendChild(totalRow);

      const deleteDebtRow = document.createElement('tr');
      const deleteDebtCell = document.createElement('td');
      deleteDebtCell.colSpan = 3;
      const deleteDebtBtn = document.createElement('button');
      deleteDebtBtn.className = 'remove-debt';
      deleteDebtBtn.textContent = 'ลบหนี้นี้';
      deleteDebtBtn.onclick = () => deleteDebt(i);
      deleteDebtCell.appendChild(deleteDebtBtn);
      deleteDebtRow.appendChild(deleteDebtCell);
      table.appendChild(deleteDebtRow);

      container.appendChild(table);
    });

    let summaryHTML = `<h3>ยอดรวมทั้งหมด: ${overallTotal.toLocaleString()} บาท</h3>`;
    summaryHTML += '<table><tr><th>เดือน</th><th>ยอดรวม</th></tr>';
    for (const m in monthlyTotals) {
      summaryHTML += `<tr><td>${m}</td><td>${monthlyTotals[m].toLocaleString()} บาท</td></tr>`;
    }
    summaryHTML += '</table>';
    summary.innerHTML = summaryHTML;
  }

  function clearData() {
    if (confirm("ต้องการล้างข้อมูลทั้งหมดใช่ไหม?")) {
      debts = [];
      saveData();
      renderDebts();
    }
  }

  renderDebts();
</script>
</body>
</html>